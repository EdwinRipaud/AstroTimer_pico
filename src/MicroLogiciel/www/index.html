<!--DOCTYPE html-->
<html>
    <head>
        <title>AstroTimer</title>
        <meta charset="UTF-8"/>
    <head/>
    
    <style type="text/css">
    </style>
    
    <script>
        function timer_api_send() {
            const data = {
                picture : parseInt(document.getElementById('picture').value),
                exposure: parseFloat(document.getElementById('exposure').value),
                delay   : parseFloat(document.getElementById('delay').value)
            };
            
            let xhr = new XMLHttpRequest();
            xhr.open("POST", '/api/timer/start', true);
            xhr.setRequestHeader("Content-Type", "application/json");
            xhr.send(JSON.stringify(data)+'\r\n');
            xhr.onloadend = function() {
                if (this.responseText == "OK") {
                    console.log(this.responseText);
                }
                else
                console.log(this.responseText);
            };
        }
        function timer_api_stop() {
            let xhr = new XMLHttpRequest();
            xhr.open("POST", '/api/timer/stop', true);
            xhr.setRequestHeader("Content-Type", "text/plain");
            xhr.send();
            xhr.onloadend = function() {
                if (this.responseText == "OK") {
                    console.log(this.responseText);
                }
                else
                console.log(this.responseText);
            };
        }
        function timer_api_update() {
            var xhr = new XMLHttpRequest();
            xhr.open("GET", "/api/timer/update", true);
            xhr.onreadystatechange = function() {
                if (xhr.readyState === 4 && xhr.status === 200) {
                    try {
                        var data = JSON.parse(xhr.responseText);
                        document.getElementById("picture").value = data.picture;
                        document.getElementById("exposure").value = data.exposure;
                        document.getElementById("delay").value = data.delay;
                    } catch (e) {
                        console.error("Error JSON:", e);
                    }
                }
            };
            xhr.send();
        }
    </script>
    
    <body>
        <div class="main" id="main">
            <h1>Welcome to AstroTimer Webapp</h1>
            <p>Work in progress...</p>
            <div class="setting_table">
                <span>Number of picture:</span><input id="picture" value="3"/><br/>
                <span>Exposure time:</span><input id="exposure" value="2"/><span>s</span><br/>
                <span>Delay time:</span><input id="delay" value="0.5"/><span>s</span><br/>
                <button id = "btn_startTimer" onclick="timer_api_send()">Start</button>
                <button id = "btn_stopTimer" onclick="timer_api_stop()">Stop</button>
            </div>
            <button onclick="timer_api_update()">Rafra√Æchir maintenant</button>
        </div>
    </body>
</html>
